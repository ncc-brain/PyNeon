
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Preprocessing: Cropping, Interpolation, and Concatenation &#8212; PyNeon dev documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=3ce10a4d"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/interpolate_and_concat';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Processing and Epoching Pupil Size Data" href="pupil_size_and_epoching.html" />
    <link rel="prev" title="Reading Native-Format Recordings" href="read_recording_native.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">PyNeon dev documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    API reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ncc-brain/PyNeon" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    API reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ncc-brain/PyNeon" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="read_recording_cloud.html">Reading Pupil Cloud-Format Recordings</a></li>
<li class="toctree-l1"><a class="reference internal" href="read_recording_native.html">Reading Native-Format Recordings</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Preprocessing: Cropping, Interpolation, and Concatenation</a></li>
<li class="toctree-l1"><a class="reference internal" href="pupil_size_and_epoching.html">Processing and Epoching Pupil Size Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="surface_mapping.html">Surface Mapping Using Fiducial Markers and Screen Corners</a></li>
<li class="toctree-l1"><a class="reference internal" href="video.html">Scene Video and Scanpath Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="export_to_bids.html">Exporting to BIDS Formats</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">PyNeon Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Preprocessing: Cropping, Interpolation, and Concatenation</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Preprocessing:-Cropping,-Interpolation,-and-Concatenation">
<h1>Preprocessing: Cropping, Interpolation, and Concatenation<a class="headerlink" href="#Preprocessing:-Cropping,-Interpolation,-and-Concatenation" title="Link to this heading">#</a></h1>
<p>Data streams from Neon devices (gaze, eye states, IMU) present three common challenges:</p>
<ol class="arabic simple">
<li><p><strong>Irregular sampling</strong>: Device limitations cause non-uniform time intervals between samples</p></li>
<li><p><strong>Different sampling rates</strong>: Each stream type has its own nominal frequency (gaze: 200 Hz, eye states: 200 Hz, IMU: 110 Hz)</p></li>
<li><p><strong>Misaligned timestamps</strong>: Streams may start and end at different times</p></li>
</ol>
<p>This tutorial shows how to address these challenges using PyNeon’s preprocessing tools: <code class="docutils literal notranslate"><span class="pre">crop()</span></code> and <code class="docutils literal notranslate"><span class="pre">restrict()</span></code> for temporal selection, <code class="docutils literal notranslate"><span class="pre">interpolate()</span></code> for resampling, and <code class="docutils literal notranslate"><span class="pre">concat_streams()</span></code> for combining multiple streams. We use the same dataset as in the <a class="reference internal" href="read_recording_cloud.html"><span class="doc">previous tutorial</span></a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyneon</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">get_sample_data</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">get_sample_data</span><span class="p">(</span><span class="s2">&quot;simple&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;native&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Load the gaze, eye states, and IMU streams from the recording. Each <code class="docutils literal notranslate"><span class="pre">Stream</span></code> object contains continuous time-series data indexed by nanosecond-precision timestamps.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rec</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">recordings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">gaze</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">gaze</span>
<span class="n">eye_states</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">eye_states</span>
<span class="n">imu</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">imu</span>


<span class="c1"># Define a function to visualize the timestamp distribution across streams</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_timestamps</span><span class="p">(</span><span class="n">gaze</span><span class="p">,</span> <span class="n">eye_states</span><span class="p">,</span> <span class="n">imu</span><span class="p">,</span> <span class="n">concat_stream</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">gaze</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">gaze</span><span class="o">.</span><span class="n">ts</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">eye_states</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">eye_states</span><span class="o">.</span><span class="n">ts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">imu</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">imu</span><span class="o">.</span><span class="n">ts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="c1"># If a concatenated stream (explained later) is provided, plot its timestamps as well</span>
    <span class="k">if</span> <span class="n">concat_stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">concat_stream</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">concat_stream</span><span class="o">.</span><span class="n">ts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;Gaze&quot;</span><span class="p">,</span> <span class="s2">&quot;Eye states&quot;</span><span class="p">,</span> <span class="s2">&quot;IMU&quot;</span><span class="p">,</span> <span class="s2">&quot;Concatenated&quot;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;Gaze&quot;</span><span class="p">,</span> <span class="s2">&quot;Eye states&quot;</span><span class="p">,</span> <span class="s2">&quot;IMU&quot;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Timestamp (ns)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<section id="Selecting-Time-Windows-with-crop()-and-restrict()">
<h2>Selecting Time Windows with <code class="docutils literal notranslate"><span class="pre">crop()</span></code> and <code class="docutils literal notranslate"><span class="pre">restrict()</span></code><a class="headerlink" href="#Selecting-Time-Windows-with-crop()-and-restrict()" title="Link to this heading">#</a></h2>
<p>Analyzing specific time windows requires selecting subsets of your data. PyNeon provides two complementary methods:</p>
<ul class="simple">
<li><p><strong>``crop()``</strong>: Extract data within a specified temporal range</p></li>
<li><p><strong>``restrict()``</strong>: Align one stream to match another’s temporal boundaries</p></li>
</ul>
<section id="Using-crop()-to-Extract-Time-Ranges">
<h3>Using <code class="docutils literal notranslate"><span class="pre">crop()</span></code> to Extract Time Ranges<a class="headerlink" href="#Using-crop()-to-Extract-Time-Ranges" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">crop()</span></code> method accepts <code class="docutils literal notranslate"><span class="pre">tmin</span></code> and <code class="docutils literal notranslate"><span class="pre">tmax</span></code> bounds (both inclusive). The <code class="docutils literal notranslate"><span class="pre">by</span></code> parameter determines how these bounds are interpreted:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">by=&quot;timestamp&quot;</span></code>: Absolute Unix timestamps in nanoseconds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">by=&quot;time&quot;</span></code>: Relative time in seconds from the stream’s first sample</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">by=&quot;sample&quot;</span></code>: Zero-based sample indices</p></li>
</ul>
<p>Let’s crop the gaze stream to the start of the recording:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>..
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crop to the first 0.3 seconds of gaze data using relative time</span>
<span class="n">gaze_300ms</span> <span class="o">=</span> <span class="n">gaze</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="c1"># Alternatively, crop to the first 200 data points</span>
<span class="n">gaze_200samples</span> <span class="o">=</span> <span class="n">gaze</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;sample&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gaze stream length before cropping: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">gaze</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gaze stream length after cropping (0.3 seconds): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">gaze_300ms</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gaze stream length after cropping (200 samples): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">gaze_200samples</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Gaze stream length before cropping: 1048
Gaze stream length after cropping (0.3 seconds): 60
Gaze stream length after cropping (200 samples): 201
</pre></div></div>
</div>
</section>
<section id="Using-restrict()-to-Align-Streams">
<h3>Using <code class="docutils literal notranslate"><span class="pre">restrict()</span></code> to Align Streams<a class="headerlink" href="#Using-restrict()-to-Align-Streams" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">restrict()</span></code> method aligns one stream to match another’s temporal boundaries. It’s a convenience wrapper equivalent to <code class="docutils literal notranslate"><span class="pre">crop(tmin=other.first_ts,</span> <span class="pre">tmax=other.last_ts,</span> <span class="pre">by=&quot;timestamp&quot;)</span></code>.</p>
<p>This is particularly useful when streams have different start/end times. In our recording, the raw IMU stream starts earlier than gaze and eye states:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_timestamps</span><span class="p">(</span>
    <span class="n">gaze_300ms</span><span class="p">,</span> <span class="n">eye_states</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmax</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">),</span> <span class="n">imu</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmax</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_interpolate_and_concat_7_0.png" src="../_images/tutorials_interpolate_and_concat_7_0.png" />
</div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">restrict()</span></code> to trim the eye states and IMU data to match gaze’s temporal range:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Restrict eye_states and imu data to match gaze_300ms&#39;s time range</span>
<span class="n">eye_states_300ms</span> <span class="o">=</span> <span class="n">eye_states</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">gaze_300ms</span><span class="p">)</span>
<span class="n">imu_300ms</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">gaze_300ms</span><span class="p">)</span>

<span class="n">plot_timestamps</span><span class="p">(</span><span class="n">gaze_300ms</span><span class="p">,</span> <span class="n">eye_states_300ms</span><span class="p">,</span> <span class="n">imu_300ms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_interpolate_and_concat_9_0.png" src="../_images/tutorials_interpolate_and_concat_9_0.png" />
</div>
</div>
</section>
</section>
<section id="Understanding-Sampling-Irregularities">
<h2>Understanding Sampling Irregularities<a class="headerlink" href="#Understanding-Sampling-Irregularities" title="Link to this heading">#</a></h2>
<p>To quantify sampling irregularities, let’s examine the distribution of time intervals between consecutive samples and compare them to the nominal sampling rates specified by Pupil Labs:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Nominal sampling frequency of gaze: </span><span class="si">{</span><span class="n">gaze</span><span class="o">.</span><span class="n">sampling_freq_nominal</span><span class="si">}</span><span class="s2"> Hz. &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Actual: </span><span class="si">{</span><span class="n">gaze</span><span class="o">.</span><span class="n">sampling_freq_effective</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> Hz&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Nominal sampling frequency of eye states: </span><span class="si">{</span><span class="n">eye_states</span><span class="o">.</span><span class="n">sampling_freq_nominal</span><span class="si">}</span><span class="s2"> Hz. &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Actual: </span><span class="si">{</span><span class="n">eye_states</span><span class="o">.</span><span class="n">sampling_freq_effective</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> Hz&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Nominal sampling frequency of IMU: </span><span class="si">{</span><span class="n">imu</span><span class="o">.</span><span class="n">sampling_freq_nominal</span><span class="si">}</span><span class="s2"> Hz. &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Actual: </span><span class="si">{</span><span class="n">imu</span><span class="o">.</span><span class="n">sampling_freq_effective</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> Hz&quot;</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">gaze</span><span class="o">.</span><span class="n">ts_diff</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1e9</span> <span class="o">/</span> <span class="n">gaze</span><span class="o">.</span><span class="n">sampling_freq_nominal</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Nominal&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Gaze&quot;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eye_states</span><span class="o">.</span><span class="n">ts_diff</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1e9</span> <span class="o">/</span> <span class="n">eye_states</span><span class="o">.</span><span class="n">sampling_freq_nominal</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Nominal&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Eye states&quot;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">imu</span><span class="o">.</span><span class="n">ts_diff</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1e9</span> <span class="o">/</span> <span class="n">imu</span><span class="o">.</span><span class="n">sampling_freq_nominal</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Nominal&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;IMU&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time difference [ns]&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Nominal sampling frequency of gaze: 200 Hz. Actual: 199.1 Hz
Nominal sampling frequency of eye states: 200 Hz. Actual: 199.1 Hz
Nominal sampling frequency of IMU: 110 Hz. Actual: 114.7 Hz
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_interpolate_and_concat_11_1.png" src="../_images/tutorials_interpolate_and_concat_11_1.png" />
</div>
</div>
<p>The histograms reveal that while most intervals cluster around the nominal rate (red line), all three streams show irregularities:</p>
<ul class="simple">
<li><p><strong>Gaze and eye states</strong>: Integer multiples of the nominal interval indicate occasional dropped frames from the eye camera</p></li>
<li><p><strong>IMU</strong>: Broader distribution suggests more variable sampling intervals</p></li>
</ul>
<p>These irregularities motivate the need for interpolation when analyses require uniform sampling.</p>
</section>
<section id="Resampling-to-Uniform-Timestamps-with-interpolate()">
<h2>Resampling to Uniform Timestamps with <code class="docutils literal notranslate"><span class="pre">interpolate()</span></code><a class="headerlink" href="#Resampling-to-Uniform-Timestamps-with-interpolate()" title="Link to this heading">#</a></h2>
<p>Many analyses require uniformly-sampled data. The <code class="docutils literal notranslate"><span class="pre">interpolate()</span></code> method resamples streams to regular intervals using <code class="docutils literal notranslate"><span class="pre">scipy.interpolate.interp1d</span></code> <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.interp1d.html">(API reference)</a>.</p>
<p>By default, <code class="docutils literal notranslate"><span class="pre">interpolate()</span></code> generates uniformly-spaced timestamps at the stream’s nominal sampling frequency (200 Hz for gaze/eye states, 110 Hz for IMU), starting from the first sample and ending at the last.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Interpolate to the nominal sampling frequency</span>
<span class="n">gaze_interp</span> <span class="o">=</span> <span class="n">gaze</span><span class="o">.</span><span class="n">interpolate</span><span class="p">()</span>

<span class="c1"># Three ways you can check if the interpolation was successful:</span>
<span class="c1"># 1. Compare the effective sampling frequency to the nominal sampling frequency</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Nominal sampling frequency of gaze: </span><span class="si">{</span><span class="n">gaze_interp</span><span class="o">.</span><span class="n">sampling_freq_nominal</span><span class="si">}</span><span class="s2"> Hz. &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Actual (after interpolation): </span><span class="si">{</span><span class="n">gaze_interp</span><span class="o">.</span><span class="n">sampling_freq_effective</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> Hz&quot;</span>
<span class="p">)</span>
<span class="c1"># 2. Check the number of unique time differences</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Only one unique time difference: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">gaze_interp</span><span class="o">.</span><span class="n">ts_diff</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># 3. Call the `is_uniformly_sampled` property (boolean)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The new gaze stream is uniformly sampled: </span><span class="si">{</span><span class="n">gaze_interp</span><span class="o">.</span><span class="n">is_uniformly_sampled</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gaze_interp</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Nominal sampling frequency of gaze: 200 Hz. Actual (after interpolation): 200.0 Hz
Only one unique time difference: [5000000]
The new gaze stream is uniformly sampled: True
gaze x [px]        float64
gaze y [px]        float64
worn               float64
azimuth [deg]      float64
elevation [deg]    float64
dtype: object
</pre></div></div>
</div>
<p>Column data types are preserved during interpolation. You can also resample to custom timestamps using the <code class="docutils literal notranslate"><span class="pre">new_ts</span></code> parameter—useful for synchronizing streams with different sampling rates. For example, resample gaze data (~200 Hz) to IMU timestamps (~110 Hz):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original gaze data length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">gaze</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original IMU data length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">imu</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">gaze_interp_to_imu</span> <span class="o">=</span> <span class="n">gaze</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">new_ts</span><span class="o">=</span><span class="n">imu</span><span class="o">.</span><span class="n">ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Gaze data length after interpolating to IMU timestamps: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">gaze_interp_to_imu</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Original gaze data length: 1048
Original IMU data length: 622
Gaze data length after interpolating to IMU timestamps: 622
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\User\Documents\GitHub\PyNeon\pyneon\preprocess\preprocess.py:67: UserWarning: 18 out of 622 requested timestamps are outside the data time range and will have empty data.
  warn(
</pre></div></div>
</div>
<p>The warning above is expected: remember that IMU recording starts earlier than gaze, so interpolating gaze to IMU timestamps will include extrapolation for the initial IMU samples. The resulting <code class="docutils literal notranslate"><span class="pre">interpolated_gaze</span></code> stream contains values at all IMU timestamps, with NaNs for timestamps outside the original gaze range.</p>
<section id="How-Interpolation-Works">
<h3>How Interpolation Works<a class="headerlink" href="#How-Interpolation-Works" title="Link to this heading">#</a></h3>
<p>By default, float columns use linear interpolation (<code class="docutils literal notranslate"><span class="pre">float_kind='linear'</span></code>), while non-float columns use nearest-neighbor (<code class="docutils literal notranslate"><span class="pre">other_kind='nearest'</span></code>). Linear interpolation estimates values at new timestamps by drawing straight lines between existing data points:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">imu_500ms</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">imu_500ms</span><span class="p">[</span><span class="s2">&quot;acceleration x [g]&quot;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Raw&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">imu_500ms</span><span class="o">.</span><span class="n">interpolate</span><span class="p">()[</span><span class="s2">&quot;acceleration x [g]&quot;</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Interpolated&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Timestamp [ns]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Acceleration x [g]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_interpolate_and_concat_19_0.png" src="../_images/tutorials_interpolate_and_concat_19_0.png" />
</div>
</div>
<p>Interpolation creates new uniformly-spaced samples (orange triangles) while preserving most original data points (blue circles) that happen to fall near the new timestamps.</p>
</section>
</section>
<section id="Combining-Streams-with-concat_streams()">
<h2>Combining Streams with <code class="docutils literal notranslate"><span class="pre">concat_streams()</span></code><a class="headerlink" href="#Combining-Streams-with-concat_streams()" title="Link to this heading">#</a></h2>
<p>Joint analysis of multiple sensors requires combining streams into a single DataFrame. The <code class="docutils literal notranslate"><span class="pre">concat_streams()</span></code> method:</p>
<ol class="arabic simple">
<li><p>Determines the common temporal overlap (from the latest start to the earliest end across all streams)</p></li>
<li><p>Interpolates all streams to uniform timestamps within this range</p></li>
<li><p>Combines columns into a single <code class="docutils literal notranslate"><span class="pre">Stream</span></code> object</p></li>
</ol>
<p>The sampling rate defaults to the lowest nominal frequency among the selected streams (110 Hz when including IMU).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">concat_stream</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">concat_streams</span><span class="p">([</span><span class="s2">&quot;gaze&quot;</span><span class="p">,</span> <span class="s2">&quot;eye_states&quot;</span><span class="p">,</span> <span class="s2">&quot;imu&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">concat_stream</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">concat_stream</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Concatenating streams:
        gaze
        eye_states
        imu
Using lowest sampling rate: 110 Hz (&lt;StringArray&gt;
[&#39;imu&#39;]
Length: 1, dtype: str)
Using latest start timestamp: 1766074431275967547 (&lt;StringArray&gt;
[&#39;gaze&#39;, &#39;eye_states&#39;]
Length: 2, dtype: str)
Using earliest last timestamp: 1766074436535834547 (&lt;StringArray&gt;
[&#39;gaze&#39;, &#39;eye_states&#39;]
Length: 2, dtype: str)
                     gaze x [px]  gaze y [px]  worn  azimuth [deg]  \
timestamp [ns]
1766074431275967547   731.885864   503.253845    -1      -4.384848
1766074431285058456   735.780922   499.996515    -1      -4.134103
1766074431294149365   735.862011   502.149531    -1      -4.128883
1766074431303240274   737.018387   503.200361    -1      -4.054441
1766074431312331183   739.273033   502.726029    -1      -3.909299

                     elevation [deg]  pupil diameter left [mm]  \
timestamp [ns]
1766074431275967547         6.207878                  4.582340
1766074431285058456         6.416890                  4.536907
1766074431294149365         6.278738                  4.528555
1766074431303240274         6.211310                  4.611737
1766074431312331183         6.241746                  4.558960

                     eyeball center left x [mm]  eyeball center left y [mm]  \
timestamp [ns]
1766074431275967547                  -30.562500                   14.062500
1766074431285058456                  -30.448863                   14.085226
1766074431294149365                  -30.534090                   14.082387
1766074431303240274                  -30.613637                   14.096591
1766074431312331183                  -30.596600                   14.073850

                     eyeball center left z [mm]  optical axis left x  ...  \
timestamp [ns]                                                        ...
1766074431275967547                  -32.062500            -0.098742  ...
1766074431285058456                  -32.056819            -0.100264  ...
1766074431294149365                  -32.058237            -0.091252  ...
1766074431303240274                  -32.144887            -0.097646  ...
1766074431312331183                  -32.011375            -0.082156  ...

                     gyro x [deg/s]  gyro y [deg/s]  gyro z [deg/s]  \
timestamp [ns]
1766074431275967547        0.270761       -3.295624        1.393119
1766074431285058456       -0.352645       -3.417501        1.581498
1766074431294149365       -0.661864       -3.321655        1.665359
1766074431303240274       -1.197607       -3.654104        1.829147
1766074431312331183       -1.479553       -3.961838        1.829147

                     acceleration x [g]  acceleration y [g]  \
timestamp [ns]
1766074431275967547           -0.033417            0.028384
1766074431285058456           -0.046604            0.024029
1766074431294149365           -0.029812            0.024873
1766074431303240274           -0.033384            0.013343
1766074431312331183           -0.034372            0.017812

                     acceleration z [g]  quaternion w  quaternion x  \
timestamp [ns]
1766074431275967547            1.012492      0.130887     -0.010311
1766074431285058456            1.014113      0.131004     -0.010321
1766074431294149365            1.006813      0.131136     -0.010400
1766074431303240274            1.016316      0.131278     -0.010472
1766074431312331183            1.007866      0.131435     -0.010574

                     quaternion y  quaternion z
timestamp [ns]
1766074431275967547     -0.010332     -0.991290
1766074431285058456     -0.010347     -0.991274
1766074431294149365     -0.010343     -0.991256
1766074431303240274     -0.010282     -0.991237
1766074431312331183     -0.010180     -0.991216

[5 rows x 35 columns]
Index([&#39;gaze x [px]&#39;, &#39;gaze y [px]&#39;, &#39;worn&#39;, &#39;azimuth [deg]&#39;,
       &#39;elevation [deg]&#39;, &#39;pupil diameter left [mm]&#39;,
       &#39;eyeball center left x [mm]&#39;, &#39;eyeball center left y [mm]&#39;,
       &#39;eyeball center left z [mm]&#39;, &#39;optical axis left x&#39;,
       &#39;optical axis left y&#39;, &#39;optical axis left z&#39;,
       &#39;pupil diameter right [mm]&#39;, &#39;eyeball center right x [mm]&#39;,
       &#39;eyeball center right y [mm]&#39;, &#39;eyeball center right z [mm]&#39;,
       &#39;optical axis right x&#39;, &#39;optical axis right y&#39;, &#39;optical axis right z&#39;,
       &#39;eyelid angle top left [rad]&#39;, &#39;eyelid angle bottom left [rad]&#39;,
       &#39;eyelid aperture left [mm]&#39;, &#39;eyelid angle top right [rad]&#39;,
       &#39;eyelid angle bottom right [rad]&#39;, &#39;eyelid aperture right [mm]&#39;,
       &#39;gyro x [deg/s]&#39;, &#39;gyro y [deg/s]&#39;, &#39;gyro z [deg/s]&#39;,
       &#39;acceleration x [g]&#39;, &#39;acceleration y [g]&#39;, &#39;acceleration z [g]&#39;,
       &#39;quaternion w&#39;, &#39;quaternion x&#39;, &#39;quaternion y&#39;, &#39;quaternion z&#39;],
      dtype=&#39;str&#39;)
</pre></div></div>
</div>
<p>Compare a 0.3-second window from the middle of the recording. The concatenated stream (bottom row) shows perfectly uniform timestamps that roughly matches the sampling rate of IMU (110 Hz).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract a time window from the middle of the recording to highlight sampling differences</span>
<span class="n">gaze_middle</span> <span class="o">=</span> <span class="n">gaze</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">3.3</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">eye_states_middle</span> <span class="o">=</span> <span class="n">eye_states</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">gaze_middle</span><span class="p">)</span>
<span class="n">imu_middle</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">gaze_middle</span><span class="p">)</span>
<span class="n">concat_stream_middle</span> <span class="o">=</span> <span class="n">concat_stream</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">gaze_middle</span><span class="p">)</span>
<span class="n">plot_timestamps</span><span class="p">(</span><span class="n">gaze_middle</span><span class="p">,</span> <span class="n">eye_states_middle</span><span class="p">,</span> <span class="n">imu_middle</span><span class="p">,</span> <span class="n">concat_stream_middle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_interpolate_and_concat_24_0.png" src="../_images/tutorials_interpolate_and_concat_24_0.png" />
</div>
</div>
<p>Despite resampling to uniform timestamps, interpolation preserves the data’s essential characteristics. Comparing the same columns before (blue circles) and after (orange triangles) concatenation shows how values remain faithful to the originals:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">gaze_middle</span><span class="p">[</span><span class="s2">&quot;gaze x [px]&quot;</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Raw gaze&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">concat_stream_middle</span><span class="p">[</span><span class="s2">&quot;gaze x [px]&quot;</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Concatenated&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;gaze x [px]&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">imu_middle</span><span class="p">[</span><span class="s2">&quot;acceleration x [g]&quot;</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Raw IMU&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">concat_stream_middle</span><span class="p">[</span><span class="s2">&quot;acceleration x [g]&quot;</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Concatenated&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;acceleration x [g]&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;timestamp [ns]&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_interpolate_and_concat_26_0.png" src="../_images/tutorials_interpolate_and_concat_26_0.png" />
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="read_recording_native.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Reading Native-Format Recordings</p>
      </div>
    </a>
    <a class="right-next"
       href="pupil_size_and_epoching.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Processing and Epoching Pupil Size Data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Selecting-Time-Windows-with-crop()-and-restrict()">Selecting Time Windows with <code class="docutils literal notranslate"><span class="pre">crop()</span></code> and <code class="docutils literal notranslate"><span class="pre">restrict()</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Using-crop()-to-Extract-Time-Ranges">Using <code class="docutils literal notranslate"><span class="pre">crop()</span></code> to Extract Time Ranges</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Using-restrict()-to-Align-Streams">Using <code class="docutils literal notranslate"><span class="pre">restrict()</span></code> to Align Streams</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Understanding-Sampling-Irregularities">Understanding Sampling Irregularities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Resampling-to-Uniform-Timestamps-with-interpolate()">Resampling to Uniform Timestamps with <code class="docutils literal notranslate"><span class="pre">interpolate()</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#How-Interpolation-Works">How Interpolation Works</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Combining-Streams-with-concat_streams()">Combining Streams with <code class="docutils literal notranslate"><span class="pre">concat_streams()</span></code></a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorials/interpolate_and_concat.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024-2026, PyNeon developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>